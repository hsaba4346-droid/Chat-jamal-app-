<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #25D366;
    --secondary: #128C7E;
    --dark: #0a0a0a;
    --darker: #1a1a1a;
    --light: #2a2a2a;
    --text: #e9edef;
    --text-dim: #8696a0;
    --danger: #ff4444;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--dark);
    color: var(--text);
    overflow: hidden;
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
#login {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
    animation: fadeIn 0.5s;
}

#login h2 {
    font-size: 2.5em;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

#login .login-box {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

input {
    padding: 15px 20px;
    margin: 10px 0;
    border-radius: 25px;
    border: 2px solid transparent;
    font-size: 16px;
    width: 300px;
    background: rgba(255,255,255,0.9);
    transition: all 0.3s;
}

input:focus {
    outline: none;
    border-color: var(--primary);
    transform: scale(1.02);
}

button {
    padding: 15px 40px;
    margin: 10px 0;
    border-radius: 25px;
    border: none;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    width: 300px;
}

.btn-primary {
    background: var(--primary);
    color: #000;
}

.btn-primary:hover {
    background: #22c55e;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
#chat {
    display: none;
    height: 100vh;
    background: var(--darker);
    animation: slideIn 0.3s;
}

/* Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
#header {
    background: var(--secondary);
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

#header h3 {
    font-size: 1.3em;
    display: flex;
    align-items: center;
    gap: 10px;
}

#onlineCount {
    background: var(--primary);
    color: #000;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: bold;
}

#logoutBtn {
    background: var(--danger);
    color: white;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 0.9em;
}

/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
#messages {
    height: calc(100vh - 140px);
    overflow-y: auto;
    padding: 20px;
    background: var(--dark);
    scroll-behavior: smooth;
}

#messages::-webkit-scrollbar {
    width: 8px;
}

#messages::-webkit-scrollbar-track {
    background: var(--darker);
}

#messages::-webkit-scrollbar-thumb {
    background: var(--light);
    border-radius: 10px;
}

/* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
.msg {
    margin-bottom: 15px;
    animation: messageSlide 0.3s;
    max-width: 80%;
}

.msg.me {
    margin-left: auto;
    margin-right: 0;
}

.msg-bubble {
    background: var(--light);
    padding: 12px 16px;
    border-radius: 15px;
    position: relative;
    word-wrap: break-word;
}

.msg.me .msg-bubble {
    background: var(--secondary);
    border-bottom-left-radius: 15px;
    border-bottom-right-radius: 2px;
}

.msg:not(.me) .msg-bubble {
    border-bottom-right-radius: 15px;
    border-bottom-left-radius: 2px;
}

.msg-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.name {
    color: var(--primary);
    font-weight: bold;
    font-size: 0.9em;
}

.time {
    color: var(--text-dim);
    font-size: 0.75em;
}

.msg-text {
    color: var(--text);
    line-height: 1.5;
    font-size: 0.95em;
}

/* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
#typingIndicator {
    color: var(--text-dim);
    font-size: 0.85em;
    padding: 10px 20px;
    display: none;
    animation: pulse 1.5s infinite;
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
#sendBox {
    display: flex;
    padding: 15px 20px;
    background: var(--darker);
    gap: 10px;
    border-top: 1px solid var(--light);
}

#messageInput {
    flex: 1;
    padding: 12px 20px;
    border-radius: 25px;
    border: none;
    background: var(--light);
    color: var(--text);
    font-size: 15px;
}

#messageInput::placeholder {
    color: var(--text-dim);
}

#sendBtn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--primary);
    color: #000;
    font-size: 1.3em;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    transition: all 0.3s;
}

#sendBtn:hover {
    transform: scale(1.1) rotate(15deg);
}

#sendBtn:active {
    transform: scale(0.95);
}

/* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
.notification {
    position: fixed;
    top: 80px;
    right: 20px;
    background: var(--secondary);
    color: white;
    padding: 15px 25px;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    animation: slideInRight 0.3s, slideOutRight 0.3s 2.7s;
    z-index: 1000;
    max-width: 300px;
}

.notification strong {
    color: var(--primary);
}

/* Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ© */
#emojiPicker {
    position: absolute;
    bottom: 80px;
    left: 20px;
    background: var(--darker);
    border: 1px solid var(--light);
    border-radius: 10px;
    padding: 10px;
    display: none;
    flex-wrap: wrap;
    width: 300px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 100;
}

.emoji {
    font-size: 1.5em;
    cursor: pointer;
    padding: 5px;
    transition: transform 0.2s;
}

.emoji:hover {
    transform: scale(1.3);
}

#emojiBtn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--light);
    color: var(--text);
    font-size: 1.5em;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

/* Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from { 
        opacity: 0;
        transform: translateY(20px);
    }
    to { 
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes messageSlide {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInRight {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}

@keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

/* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media (max-width: 600px) {
    input, button {
        width: 250px;
    }
    
    .msg {
        max-width: 90%;
    }
    
    #emojiPicker {
        width: calc(100% - 40px);
        left: 20px;
    }
}
</style>
</head>

<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="login">
    <h2>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h2>
    <div class="login-box">
        <input id="username" placeholder="âœ¨ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" maxlength="20">
        <button class="btn-primary" onclick="enterChat()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
    </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
<div id="chat">
    <div id="header">
        <h3>
            ğŸ’¬ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            <span id="onlineCount">ğŸ‘¥ 0</span>
        </h3>
        <button id="logoutBtn" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
    
    <div id="messages"></div>
    
    <div id="typingIndicator">
        <span id="typingText"></span>
    </div>
    
    <div id="sendBox">
        <button id="emojiBtn" onclick="toggleEmoji()">ğŸ˜Š</button>
        <input id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." maxlength="500">
        <button id="sendBtn" onclick="sendMessage()">âœˆï¸</button>
    </div>
    
    <div id="emojiPicker"></div>
</div>

<!-- Ø£ØµÙˆØ§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
<audio id="notificationSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE=" type="audio/wav">
</audio>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ğŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCt8LhlTpYzykK8tacEockGq1mM2RlX0g8",
  authDomain: "chat-jamal-app.firebaseapp.com",
  databaseURL: "https://chat-jamal-app-default-rtdb.firebaseio.com",
  projectId: "chat-jamal-app",
  storageBucket: "chat-jamal-app.firebasestorage.app",
  messagingSenderId: "982435518690",
  appId: "1:982435518690:web:51ae3c73dc341b83c826bb"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===============================
// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
// ===============================
let user = "";
let userColor = "";
let lastMessageTime = 0;
let typingTimeout;
let onlineRef;

// Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ©
const emojis = ["ğŸ˜€","ğŸ˜","ğŸ˜‚","ğŸ¤£","ğŸ˜ƒ","ğŸ˜„","ğŸ˜…","ğŸ˜†","ğŸ˜‰","ğŸ˜Š","ğŸ˜‹","ğŸ˜","ğŸ˜","ğŸ˜˜","ğŸ¥°","ğŸ˜—","ğŸ˜™","ğŸ˜š","â˜ºï¸","ğŸ™‚","ğŸ¤—","ğŸ¤©","ğŸ¤”","ğŸ¤¨","ğŸ˜","ğŸ˜‘","ğŸ˜¶","ğŸ™„","ğŸ˜","ğŸ˜£","ğŸ˜¥","ğŸ˜®","ğŸ¤","ğŸ˜¯","ğŸ˜ª","ğŸ˜«","ğŸ˜´","ğŸ˜Œ","ğŸ˜›","ğŸ˜œ","ğŸ˜","ğŸ¤¤","ğŸ˜’","ğŸ˜“","ğŸ˜”","ğŸ˜•","ğŸ™ƒ","ğŸ¤‘","ğŸ˜²","â˜¹ï¸","ğŸ™","ğŸ˜–","ğŸ˜","ğŸ˜Ÿ","ğŸ˜¤","ğŸ˜¢","ğŸ˜­","ğŸ˜¦","ğŸ˜§","ğŸ˜¨","ğŸ˜©","ğŸ¤¯","ğŸ˜¬","ğŸ˜°","ğŸ˜±","ğŸ¥µ","ğŸ¥¶","ğŸ˜³","ğŸ¤ª","ğŸ˜µ","ğŸ˜¡","ğŸ˜ ","ğŸ¤¬","ğŸ‘","ğŸ‘","ğŸ‘Œ","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ‘‡","â˜ï¸","âœ‹","ğŸ¤š","ğŸ–","ğŸ––","ğŸ‘‹","ğŸ¤™","ğŸ’ª","ğŸ–•","âœï¸","ğŸ™","ğŸ’‹","ğŸ’˜","ğŸ’","ğŸ’–","ğŸ’—","ğŸ’“","ğŸ’","ğŸ’•","ğŸ’Ÿ","â£ï¸","ğŸ’”","â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ¤","ğŸ–¤","ğŸ¤","ğŸ’¯","ğŸ’¢","ğŸ’¥","ğŸ’«","ğŸ’¦","ğŸ’¨","ğŸ•Š","ğŸ¦‹","ğŸ","ğŸ›"];

// ===============================
// Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
// ===============================
function enterChat() {
    user = document.getElementById("username").value.trim();
    if (!user) {
        alert("âŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
        return;
    }
    
    if (user.length < 2) {
        alert("âŒ Ø§Ù„Ø§Ø³Ù… Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹");
        return;
    }
    
    // ØªÙˆÙ„ÙŠØ¯ Ù„ÙˆÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    userColor = '#' + Math.floor(Math.random()*16777215).toString(16);
    
    document.getElementById("login").style.display = "none";
    document.getElementById("chat").style.display = "block";
    
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ€ online
    onlineRef = db.ref('online/' + Date.now() + '_' + user);
    onlineRef.set({
        name: user,
        time: Date.now()
    });
    onlineRef.onDisconnect().remove();
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
    db.ref('online').on('value', snap => {
        const count = snap.numChildren();
        document.getElementById('onlineCount').textContent = 'ğŸ‘¥ ' + count;
    });
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø®ÙˆÙ„
    db.ref("messages").push({
        type: 'system',
        text: `${user} Ø¯Ø®Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ğŸ‘‹`,
        time: Date.now()
    });
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ©
    loadEmojis();
    
    // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    document.getElementById("messageInput").focus();
    
    // ØªÙØ¹ÙŠÙ„ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
    document.getElementById("messageInput").addEventListener('input', handleTyping);
}

// ===============================
// Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
// ===============================
function sendMessage() {
    const text = document.getElementById("messageInput").value.trim();
    if (!text) return;
    
    // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø²Ø¹Ø§Ø¬ (spam)
    const now = Date.now();
    if (now - lastMessageTime < 1000) {
        showNotification("âš ï¸ ØªÙ…Ù‡Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹!");
        return;
    }
    lastMessageTime = now;
    
    db.ref("messages").push({
        name: user,
        text: text,
        time: now,
        color: userColor
    });
    
    document.getElementById("messageInput").value = "";
    
    // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
    db.ref('typing/' + user).remove();
}

// ===============================
// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
// ===============================
db.ref("messages").limitToLast(50).on("child_added", snap => {
    const msg = snap.val();
    const div = document.createElement("div");
    
    if (msg.type === 'system') {
        div.className = "msg system";
        div.innerHTML = `
            <div class="msg-bubble" style="background: rgba(37, 211, 102, 0.2); text-align: center;">
                <div class="msg-text">${msg.text}</div>
            </div>
        `;
    } else {
        const isMe = msg.name === user;
        div.className = isMe ? "msg me" : "msg";
        
        const time = new Date(msg.time).toLocaleTimeString('ar-SA', {
            hour: '2-digit',
            minute: '2-digit'
        });
        
        div.innerHTML = `
            <div class="msg-bubble">
                ${!isMe ? `<div class="msg-header">
                    <span class="name" style="color: ${msg.color || '#25D366'}">${msg.name}</span>
                    <span class="time">${time}</span>
                </div>` : ''}
                <div class="msg-text">${escapeHtml(msg.text)}</div>
                ${isMe ? `<div class="time" style="text-align: left; margin-top: 5px;">${time}</div>` : ''}
            </div>
        `;
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù„ÙŠØ³Øª Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ)
        if (!isMe && msg.time > Date.now() - 3000) {
            playNotificationSound();
            showNotification(`ğŸ’¬ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ${msg.name}`);
        }
    }
    
    document.getElementById("messages").appendChild(div);
    scrollToBottom();
});

// ===============================
// Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
// ===============================
function handleTyping() {
    const input = document.getElementById("messageInput").value;
    
    if (input.length > 0) {
        db.ref('typing/' + user).set(true);
        
        clearTimeout(typingTimeout);
        typingTimeout = setTimeout(() => {
            db.ref('typing/' + user).remove();
        }, 2000);
    } else {
        db.ref('typing/' + user).remove();
    }
}

db.ref('typing').on('value', snap => {
    const typing = snap.val();
    const indicator = document.getElementById('typingIndicator');
    
    if (typing) {
        const names = Object.keys(typing).filter(name => name !== user);
        if (names.length > 0) {
            indicator.style.display = 'block';
            document.getElementById('typingText').textContent = 
                names.length === 1 
                ? `${names[0]} ÙŠÙƒØªØ¨...` 
                : `${names.length} Ø£Ø´Ø®Ø§Øµ ÙŠÙƒØªØ¨ÙˆÙ†...`;
        } else {
            indicator.style.display = 'none';
        }
    } else {
        indicator.style.display = 'none';
    }
});

// ===============================
// Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ©
// ===============================
function loadEmojis() {
    const picker = document.getElementById('emojiPicker');
    emojis.forEach(emoji => {
        const span = document.createElement('span');
        span.className = 'emoji';
        span.textContent = emoji;
        span.onclick = () => insertEmoji(emoji);
        picker.appendChild(span);
    });
}

function toggleEmoji() {
    const picker = document.getElementById('emojiPicker');
    picker.style.display = picker.style.display === 'flex' ? 'none' : 'flex';
}

function insertEmoji(emoji) {
    const input = document.getElementById('messageInput');
    input.value += emoji;
    input.focus();
}

// ===============================
// Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø£ØµÙˆØ§Øª
// ===============================
function showNotification(message) {
    const notif = document.createElement('div');
    notif.className = 'notification';
    notif.innerHTML = message;
    document.body.appendChild(notif);
    
    setTimeout(() => {
        notif.remove();
    }, 3000);
    
    // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
    if (Notification.permission === "granted") {
        new Notification("Ø¯Ø±Ø¯Ø´Ø© Ø¬Ø¯ÙŠØ¯Ø©", {
            body: message,
            icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ’¬</text></svg>"
        });
    }
}

function playNotificationSound() {
    const sound = document.getElementById('notificationSound');
    sound.play().catch(e => console.log('Sound play failed:', e));
}

// Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
if (Notification.permission === "default") {
    Notification.requestPermission();
}

// ===============================
// ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ©
// ===============================
function logout() {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©ØŸ")) {
        db.ref("messages").push({
            type: 'system',
            text: `${user} ØºØ§Ø¯Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ğŸ‘‹`,
            time: Date.now()
        });
        
        if (onlineRef) onlineRef.remove();
        location.reload();
    }
}

function scrollToBottom() {
    const messages = document.getElementById("messages");
    messages.scrollTop = messages.scrollHeight;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
document.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && document.getElementById('chat').style.display === 'block') {
        sendMessage();
    }
});

// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ù…ÙˆØ² Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener('click', (e) => {
    const picker = document.getElementById('emojiPicker');
    const btn = document.getElementById('emojiBtn');
    if (!picker.contains(e.target) && e.target !== btn) {
        picker.style.display = 'none';
    }
});
</script>

</body>
</html>
